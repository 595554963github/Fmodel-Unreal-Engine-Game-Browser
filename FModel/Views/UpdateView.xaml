<adonisControls:AdonisWindow 
    x:Class="FModel.Views.UpdateView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:FModel.Settings"
    xmlns:converters="clr-namespace:FModel.Views.Resources.Converters"
    xmlns:adonisUi="clr-namespace:AdonisUI;assembly=AdonisUI"
    xmlns:adonisExtensions="clr-namespace:AdonisUI.Extensions;assembly=AdonisUI"
    xmlns:adonisControls="clr-namespace:AdonisUI.Controls;assembly=AdonisUI"
    xmlns:controls="clr-namespace:FModel.Views.Resources.Controls"
    WindowStartupLocation="CenterScreen" 
    IconVisibility="Collapsed" 
    ResizeMode="CanMinimize" 
    Loaded="OnLoaded"
    MinHeight="{Binding Source={x:Static SystemParameters.MaximizedPrimaryScreenHeight}, Converter={converters:RatioConverter}, ConverterParameter='0.40'}"
    Width="{Binding Source={x:Static SystemParameters.MaximizedPrimaryScreenWidth}, Converter={converters:RatioConverter}, ConverterParameter='0.35'}"
    Title="发布">

    <adonisControls:AdonisWindow.Style>
        <Style TargetType="adonisControls:AdonisWindow" BasedOn="{StaticResource {x:Type adonisControls:AdonisWindow}}"/>
    </adonisControls:AdonisWindow.Style>

    <adonisControls:AdonisWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Resources.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </adonisControls:AdonisWindow.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="1"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <TextBlock 
            Grid.Row="0" 
            TextWrapping="Wrap" 
            HorizontalAlignment="Left" 
            Margin="0 0 0 5"
            Text="下面列出的所有版本都可供下载，它们按日期排序，最新版本位于顶部。我们会定期删除旧版本，以保持列表干净并更新最新的UE版本。如果您希望手动检查更新，可通过帮助 &gt; 发布菜单访问此窗口。(注意:不建议随便更新，无论升级还是降级，汉化均会被覆盖)"/>

        <Grid 
            Grid.Row="1" 
            HorizontalAlignment="Stretch" 
            Margin="0 10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Button 
                Grid.Column="0" 
                Style="{DynamicResource {x:Static adonisUi:Styles.AccentButton}}"
                Padding="8 4" 
                Click="OnDownloadLatest">
                下载最新版本
            </Button>

            <StackPanel 
                Grid.Column="2" 
                Orientation="Vertical" 
                HorizontalAlignment="Right" 
                Margin="10 0 0 0">
                <adonisControls:SplitButton 
                    x:Name="RemindButton" 
                    Content="现在提醒我..." 
                    Command="{Binding RemindMeCommand}"
                    Padding="5">
                    <adonisControls:SplitButton.SplitMenu>
                        <ContextMenu>
                            <MenuItem Header="在3天内" Command="{Binding RemindMeCommand}" CommandParameter="Days"/>
                            <MenuItem Header="下周" Command="{Binding RemindMeCommand}" CommandParameter="Week"/>
                            <MenuItem Header="下个月" Command="{Binding RemindMeCommand}" CommandParameter="Month"/>
                            <MenuItem Header="从不" Command="{Binding RemindMeCommand}" CommandParameter="Never"/>
                        </ContextMenu>
                    </adonisControls:SplitButton.SplitMenu>
                </adonisControls:SplitButton>
                <TextBlock 
                    VerticalAlignment="Bottom" 
                    HorizontalAlignment="Right" 
                    FontSize="10" 
                    Margin="0 5 0 0"
                    Text="{Binding NextUpdateCheck, Source={x:Static local:UserSettings.Default}, StringFormat='下一次刷新: {0:yyyy年MM月d日}'}"/>
            </StackPanel>
        </Grid>

        <Separator 
            Grid.Row="2" 
            Style="{StaticResource CustomSeparator}" 
            Tag="历史版本" 
            Margin="0 15"/>

        <ScrollViewer Grid.Row="3" Margin="0 10">
            <ItemsControl ItemsSource="{Binding CommitsView}">
                <ItemsControl.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.ContainerStyle>
                            <Style TargetType="GroupItem">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="GroupItem">
                                            <GroupBox 
                                                adonisExtensions:LayerExtension.Layer="3"
                                                Header="{Binding Name}"
                                                HeaderStringFormat="提交于{0:yyyy年MM月d日}"
                                                Margin="0 0 0 5">
                                                <ItemsPresenter/>
                                            </GroupBox>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </GroupStyle.ContainerStyle>
                        <GroupStyle.Panel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical"/>
                            </ItemsPanelTemplate>
                        </GroupStyle.Panel>
                    </GroupStyle>
                </ItemsControl.GroupStyle>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <controls:CommitControl Margin="0 0 0 1"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</adonisControls:AdonisWindow>